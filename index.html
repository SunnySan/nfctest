<!DOCTYPE html>
<html>
	<title>MyVIBO</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!--<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />--><!--JQuery Mobile theme-->
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.min.css" />
	<link rel="stylesheet" href="css/vmall.min.css" /><!--將JQuery Mobile theme加上 swatch="F"-->
	<link rel="stylesheet" href="css/jquery.mobile.simpledialog.min.css" /><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<link rel="stylesheet" href="css/style.css" />
	
	<script src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/initJQueryMobile.js"></script><!--初始化 JQuery Mobile -->
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	<script src="js/jquery.mobile.simpledialog2.min.js"></script><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<script type="text/javascript" src="js/util.js"></script>
	<!--<script type="text/javascript" src="js/ga.js"></script>--><!--Browser用的Google Analytics 追蹤函數-->
	<script type="text/javascript" src="js/jquery.blockUI.js"></script><!--JQuery BlockUI，請參考http://www.malsup.com/jquery/block/ -->
	<script src="cordova.js"></script><!--給PhoneGap用的-->
	<script type="text/javascript" src="js/phonegap-nfc.js"></script><!--NFC，請參考https://github.com/chariotsolutions/phonegap-nfc -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>

<body>

<!-- ****************************** 首頁 ***********************************-->
<div data-role="page" id="home">
	<div data-role="header" data-position="fixed" class="vibo-header">
		<div class="header-padding"></div>
		<div data-role="navbar">
			<ul class="navbar-content-area">
				<li><a href="#home">V-Living NFC測試</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /header -->
	
	<div data-role="content">
		<!--
		<input type="button" value="設定監聽器" onclick="setListener();">
		<hr>
		-->
		<div>威寶企網首頁</div>
		<input type="text" name="text1" id="text1" value="http://www.vibo.com.tw/">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text1');">
		<hr>
		<div>面對面的讚，更讚! 拔牙篇_完整版</div>
		<input type="text" name="text2" id="text2" value="https://www.youtube.com/watch?v=S-diRjy6DKU">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text2');">
		<hr>
		<div>【鋼鐵人３】中文戲院版預告 [Full HD]</div>
		<input type="text" name="text3" id="text3" value="https://www.youtube.com/watch?v=XNrSGoq_77k">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text3');">
		<hr>
		<div>威寶週年慶抽獎活動</div>
		<input type="text" name="text4" id="text4" value="http://event.vibo.net.tw/201312/index.html">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text4');">
	</div><!-- /content -->
</div><!-- 首頁 -->

</body>
</html>
<script type="text/javascript" src="js/initPage.js"></script><!--初始化頁面，設定header及footer -->

<script type="text/javascript">

	var sRecord = "";

	document.addEventListener("deviceready", onDeviceReady, false);
	
	function onDeviceReady() {
		nfc.addTagDiscoveredListener(function(){writeToTag();}, function(){alert("設定監聽器成功");}, function(){alert("設定監聽器失敗");});
	}
	

	function writeToTag(){
		if (beEmpty(sRecord)) return;
		var message = [
			ndef.uriRecord(sRecord)
		];
		nfc.write(message, function(){unBlockUI();alert("寫入成功");sRecord="";}, function(){unBlockUI();alert("寫入失敗");});
	}



function ready() {

    function onNfc(nfcEvent) {

        var tag = nfcEvent.tag;
        var tagId = nfc.bytesToHexString(tag.id);
        alert(tagId);

    }

    function win() {
        console.log("Listening for NFC Tags");
    }

    function fail(error) {
        alert("Error adding NFC listener");
    }


    //nfc.addTagDiscoveredListener(onNfc, win, fail);
    alert('addEventListener_begin');
    document.addEventListener("tag", onNfc, false);
    alert('addEventListener_end');
		alert(typeof(cordova));
    cordova.exec(win, fail, "NfcPlugin", "registerTag", []);
    alert('cordova.exec_end');

}

function init() {
    document.addEventListener('deviceready', ready, false);
}

	//document.addEventListener("deviceReady", onDeviceReady, false);
	function setListener() {
		alert(typeof(nfc));
		nfc.addTagDiscoveredListener(function(){alert("addTagDiscoveredListener_detected");}, function(){alert("addTagDiscoveredListener_success");}, function(){alert("addTagDiscoveredListener_fail");});
		//ready();
		nfc.addMimeTypeListener('text/pg', function(){alert("addMimeTypeListener_detected");}, function(){alert("addMimeTypeListener_success");}, function(){alert("addMimeTypeListener_fail");});
		nfc.addNdefListener(function(){alert("addNdefListener_detected");}, function(){alert("addNdefListener_success");}, function(){alert("addNdefListener_fail");});
		nfc.addNdefFormatableListener(function(){alert("addNdefFormatableListener_detected");}, function(){alert("addNdefFormatableListener_success");}, function(){alert("addNdefFormatableListener_fail");});
		alert('done');
	}

	function writeTag(text){
		var s = $('#home #' + text).val();
		sRecord = s;
		showBlockUI();
	}
</script>
