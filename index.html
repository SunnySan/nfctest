<!DOCTYPE html>
<html>
	<title>MyVIBO</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!--<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />--><!--JQuery Mobile theme-->
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.min.css" />
	<link rel="stylesheet" href="css/vmall.min.css" /><!--將JQuery Mobile theme加上 swatch="F"-->
	<link rel="stylesheet" href="css/jquery.mobile.simpledialog.min.css" /><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<link rel="stylesheet" href="css/style.css" />
	
	<script src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/initJQueryMobile.js"></script><!--初始化 JQuery Mobile -->
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	<script src="js/jquery.mobile.simpledialog2.min.js"></script><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<script type="text/javascript" src="js/util.js"></script>
	<!--<script type="text/javascript" src="js/ga.js"></script>--><!--Browser用的Google Analytics 追蹤函數-->
	<script type="text/javascript" src="js/jquery.blockUI.js"></script><!--JQuery BlockUI，請參考http://www.malsup.com/jquery/block/ -->
	<script src="cordova.js"></script><!--給PhoneGap用的-->
	<script type="text/javascript" src="js/phonegap-nfc.js"></script><!--NFC，請參考https://github.com/chariotsolutions/phonegap-nfc -->
	<script src="js/plugins/LaunchMyApp.js"></script><!--Launch my app，請參考 https://github.com/EddyVerbruggen/LaunchMyApp-PhoneGap-Plugin/blob/d1432ecfff63678a3155804839dda21607706e72/README.md -->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>

<body>

<!-- ****************************** 首頁 ***********************************-->
<div data-role="page" id="home">
	<div data-role="header" data-position="fixed" class="vibo-header">
		<div class="header-padding"></div>
		<div data-role="navbar">
			<ul class="navbar-content-area">
				<li><a href="#home">V-Living NFC測試</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /header -->
	
	<div data-role="content">
		<!--
		<input type="button" value="設定監聽器" onclick="setListener();">
		<hr>
		-->
		<div>威寶企網首頁</div>
		<input type="text" name="text1" id="text1" value="http://www.vibo.com.tw/">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text1');">
		<hr>
		<div>面對面的讚，更讚! 拔牙篇_完整版</div>
		<input type="text" name="text2" id="text2" value="https://www.youtube.com/watch?v=S-diRjy6DKU">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text2');">
		<hr>
		<div>【鋼鐵人３】中文戲院版預告 [Full HD]</div>
		<input type="text" name="text3" id="text3" value="https://www.youtube.com/watch?v=XNrSGoq_77k">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text3');">
		<hr>
		<div>威寶週年慶抽獎活動</div>
		<input type="text" name="text4" id="text4" value="http://event.vibo.net.tw/201312/index.html">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text4');">
		<hr>
		<div>Coupon</div>
		<input type="text" name="text5" id="text5" value="nfctest://index.html?c=1">
		<input type="button" value="寫入NFC Tag" onclick="writeTag('text5');">
	</div><!-- /content -->
</div><!-- 首頁 -->

</body>
</html>
<script type="text/javascript" src="js/initPage.js"></script><!--初始化頁面，設定header及footer -->

<script type="text/javascript">

	var sRecord = "";	//寫入至NFC的內容，若此變數無值則不寫入NFC

	document.addEventListener("deviceready", onDeviceReady, false);
	
	function onDeviceReady() {	//程式啟動時先設定監聽器
		//nfc.addTagDiscoveredListener(function(){writeToTag();}, function(){alert("設定監聽器成功");}, function(){alert("設定監聽器失敗");});
		nfc.addTagDiscoveredListener(function(){writeToTag();}, function(){}, function(){alert("設定監聽器失敗");});
	}	//function onDeviceReady() {	//程式啟動時先設定監聽器

	function handleOpenURL(url) {
		var s = getParameterByName("c", url);
		alert("received url: " + url);
		if (notEmpty(s)) alert("恭喜您獲得折價券一張");
	}
	
	function writeTag(text){	//準備寫入NFC
		var s = $('#home #' + text).val();
		sRecord = s;
		showBlockUI();
	}	//function writeTag(text){	//準備寫入NFC

	function writeToTag(){	//當手機靠近NFC標籤時，將資料寫入NFC
		if (beEmpty(sRecord)) return;
		var message = [
			ndef.uriRecord(sRecord)
		];
		nfc.write(message, function(){unBlockUI();alert("寫入成功");sRecord="";}, function(){unBlockUI();alert("寫入失敗");});
	}	//function writeToTag(){	//當手機靠近NFC標籤時，將資料寫入NFC

	function setListener() {	//這個函數目前沒在用
		alert(typeof(nfc));
		nfc.addTagDiscoveredListener(function(){alert("addTagDiscoveredListener_detected");}, function(){alert("addTagDiscoveredListener_success");}, function(){alert("addTagDiscoveredListener_fail");});
		//ready();
		nfc.addMimeTypeListener('text/pg', function(){alert("addMimeTypeListener_detected");}, function(){alert("addMimeTypeListener_success");}, function(){alert("addMimeTypeListener_fail");});
		nfc.addNdefListener(function(){alert("addNdefListener_detected");}, function(){alert("addNdefListener_success");}, function(){alert("addNdefListener_fail");});
		nfc.addNdefFormatableListener(function(){alert("addNdefFormatableListener_detected");}, function(){alert("addNdefFormatableListener_success");}, function(){alert("addNdefFormatableListener_fail");});
		alert('done');
	}

</script>
